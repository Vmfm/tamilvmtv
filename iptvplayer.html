<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TAMIL VM IPTV MANAGER</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link href="https://unpkg.com/video.js/dist/video-js.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<script src="https://unpkg.com/video.js/dist/video.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<style>
:root{
 --bg:#000;--card:#111;--text:#fff;--border:#333;
}
body.light{
 --bg:#f5f5f5;--card:#fff;--text:#000;--border:#ccc;
}
body{background:var(--bg);color:var(--text);font-family:sans-serif}

/* HEADER */
.header{
 position:fixed;top:0;left:0;width:100%;
 background:var(--card);z-index:9999;
 padding:10px;text-align:center;
}
.video-js{width:100%;height:220px}
.main{margin-top:450px}

/* TOGGLE */
.toggle-btn{
 position:fixed;top:15px;right:15px;z-index:10001;
 background:#ff9800;color:#000;
 border:none;padding:6px 12px;border-radius:20px;
}

/* PLAYLIST MANAGER */
.playlist-item{
 border:1px solid var(--border);
 background:var(--card);
 padding:5px;
 margin-bottom:5px;
 cursor:pointer;
 display:flex;justify-content:space-between;align-items:center;
}
.playlist-item button{
 margin-left:5px;font-size:12px;padding:2px 5px;
}

/* CHANNEL */
.channel{
 border:1px solid var(--border);
 background:var(--card);margin-bottom:10px;
 text-align:center;cursor:pointer;padding:5px;
}
.channel img{width:100%;height:120px;object-fit:contain}
.channel p{font-size:12px;margin:3px 0}
.views{font-size:10px;color:#ff9800}

/* FULLSCREEN FILL */
.vjs-tech{object-fit:contain}
body.cover-mode .vjs-tech{object-fit:cover}
</style>
</head>

<body>

<button class="toggle-btn" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

<div class="header">
 <h4 class="text-warning">TAMIL VM IPTV MANAGER</h4>

 <!-- Playlist Manager -->
 <div class="form-group mt-2">
   <input type="text" id="playlistName" class="form-control mb-1" placeholder="Playlist Name">
   <input type="text" id="playlistURL" class="form-control mb-1" placeholder="Playlist M3U URL">
   <button class="btn btn-success btn-block" onclick="addPlaylist()">Add Playlist</button>
 </div>

 <div id="playlistsContainer"></div>

 <video id="tvPlayer" class="video-js vjs-default-skin"
  controls autoplay playsinline webkit-playsinline></video>
</div>

<div class="container main">
 <div class="row mb-2">
  <div class="col-6">
   <input type="text" id="search" class="form-control" placeholder="Search channel">
  </div>
  <div class="col-6">
   <select id="category" class="form-control">
    <option value="all">All Categories</option>
   </select>
  </div>
 </div>
 <div class="row" id="channelList"></div>
</div>

<script>
const player = videojs('tvPlayer');
let allChannels = [], views = JSON.parse(localStorage.getItem('views')||'{}'), currentSrc=null;

// THEME
if(localStorage.getItem('theme')==='light') document.body.classList.add('light');
function toggleTheme(){
 document.body.classList.toggle('light');
 localStorage.setItem('theme', document.body.classList.contains('light')?'light':'dark');
}

// PLAYLIST STORAGE
let playlists = JSON.parse(localStorage.getItem('playlists')||'[]');

function savePlaylists(){ localStorage.setItem('playlists', JSON.stringify(playlists)); }

function renderPlaylists(){
 const container = $('#playlistsContainer');
 container.html('');
 playlists.forEach((p,i)=>{
   container.append(`
     <div class="playlist-item">
       <span>${p.name}</span>
       <div>
         <button onclick="loadPlaylist(${i})">Load</button>
         <button onclick="editPlaylist(${i})">Edit</button>
         <button onclick="deletePlaylist(${i})">Delete</button>
       </div>
     </div>
   `);
 });
}
renderPlaylists();

function addPlaylist(){
 const name = $('#playlistName').val().trim();
 const url = $('#playlistURL').val().trim();
 if(!name || !url) return alert('Enter both name and URL');
 playlists.push({name,url});
 savePlaylists();
 renderPlaylists();
 $('#playlistName,#playlistURL').val('');
}

function editPlaylist(i){
 const name = prompt('Edit playlist name', playlists[i].name);
 const url = prompt('Edit playlist URL', playlists[i].url);
 if(name && url){
   playlists[i]={name,url};
   savePlaylists();
   renderPlaylists();
 }
}

function deletePlaylist(i){
 if(confirm('Delete this playlist?')){
   playlists.splice(i,1);
   savePlaylists();
   renderPlaylists();
 }
}

// LOAD PLAYLIST
function loadPlaylist(i){
 const url = playlists[i].url;
 fetch(url).then(r=>r.text()).then(d=>{
   allChannels=[];
   d.split('\n').forEach((l,j,a)=>{
     if(l.startsWith('#EXTINF')){
       allChannels.push({
         name: l.split(',').pop().trim(),
         logo: (l.match(/tvg-logo="(.*?)"/)||[])[1] || 'https://via.placeholder.com/300x200?text=TV',
         group: (l.match(/group-title="(.*?)"/)||[])[1] || 'Other',
         url: a[j+1]?.trim()
       });
     }
   });
   buildCategories();
   renderChannels();
 });
}

// CATEGORY
function buildCategories(){
 $('#category').html('<option value="all">All Categories</option>');
 [...new Set(allChannels.map(c=>c.group))].forEach(g=>$('#category').append(`<option>${g}</option>`));
}

// RENDER CHANNELS
function renderChannels(){
 const s=$('#search').val().toLowerCase(),c=$('#category').val();
 $('#channelList').html('');
 allChannels.filter(x=>(c==='all'||x.group===c) && x.name.toLowerCase().includes(s))
  .forEach(x=>{
    $('#channelList').append(`
      <div class="col-4 col-md-2">
        <div class="channel" data-src="${x.url}" data-name="${x.name}">
          <img src="${x.logo}">
          <p>${x.name}</p>
          <div class="views">üëÅ ${(views[x.name]||0)} views</div>
        </div>
      </div>
    `);
  });
}
$('#search,#category').on('input change',renderChannels);

// PLAY CHANNEL
$(document).on('click','.channel',function(){
 const n=$(this).data('name');
 currentSrc=$(this).data('src');
 views[n]=(views[n]||0)+1;
 localStorage.setItem('views',JSON.stringify(views));
 renderChannels();
 player.src({src:currentSrc,type:'application/x-mpegURL'});
 player.play();
 window.scrollTo({top:0,behavior:'smooth'});
});

// FULLSCREEN BUTTON
const zoomBtn = player.controlBar.addChild('button',{});
zoomBtn.addClass('vjs-control');
zoomBtn.el().innerHTML='‚õ∂';
zoomBtn.el().title='Fill Screen';
zoomBtn.onclick = ()=>{ document.body.classList.toggle('cover-mode'); };

// AUTO ROTATE
player.on('fullscreenchange',()=>{
 if(player.isFullscreen()){
  document.body.classList.add('cover-mode');
  screen.orientation?.lock('landscape').catch(()=>{});
 }else{
  document.body.classList.remove('cover-mode');
  screen.orientation?.unlock?.();
 }
});
</script>

</body>
</html>
