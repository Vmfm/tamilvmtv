<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Secure HLS/DASH Player</title>

<style>
body {
  margin: 0;
  background: #000;
  height: 100vh;
  overflow: hidden;
}

/* Player wrapper */
#player-wrapper {
  position: relative;
  width: 100%;
  height: 100vh;
  background: black;
}

/* Force video fill */
#video-player video,
#clappr-player video {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover;   /* ðŸ”¥ FILL screen */
}

/* Control bar */
#controls {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 9999;
  display: flex;
  gap: 8px;
  background: rgba(0,0,0,0.6);
  padding: 6px 8px;
  border-radius: 6px;

  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* Show controls */
#controls.show {
  opacity: 1;
  pointer-events: auto;
}

#controls button,
#controls select {
  background: #111;
  color: #fff;
  border: 1px solid #444;
  padding: 5px 8px;
  font-size: 13px;
  cursor: pointer;
  border-radius: 4px;
}
</style>
</head>

<body>

<div id="player-wrapper">
  <div id="controls">
    <select id="aspectRatio">
      <option value="fill">Fill</option>
      <option value="contain">Fit</option>
    </select>
    <button id="fullscreenBtn">â›¶</button>
  </div>

  <div id="video-player"></div>
  <div id="clappr-player" style="display:none;"></div>
</div>

<!-- JW Player -->
<script src="https://cdn.jwplayer.com/libraries/MAaRkUjT.js"></script>

<!-- Clappr -->
<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clappr-drm@latest/dist/clappr-drm.min.js"></script>

<script>
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    mpd: params.get("mpd"),
    keyId: params.get("keyId"),
    key: params.get("key")
  };
}

function playStream(url, keyId, key) {
  if (!url) return;

  if (typeof jwplayer !== "undefined") {
    jwplayer("video-player").setup({
      file: url,
      width: "100%",
      height: "100%",
      autostart: true,
      stretching: "fill",
      drm: key && keyId ? { clearkey: { keyId, key } } : undefined
    });
    return;
  }

  document.getElementById("clappr-player").style.display = "block";
  new Clappr.Player({
    source: url,
    parentId: "#clappr-player",
    autoPlay: true,
    width: "100%",
    height: "100%",
    plugins: key && keyId ? [ClapprDRM] : [],
    playback: key && keyId ? {
      drm: { clearkey: { keys: [{ keyId, key }] } }
    } : {}
  });
}

/* Touch to show controls (Android friendly) */
let hideTimer;
const wrapper = document.getElementById("player-wrapper");
const controls = document.getElementById("controls");

wrapper.addEventListener("touchstart", showControls);
wrapper.addEventListener("click", showControls);

function showControls() {
  controls.classList.add("show");
  clearTimeout(hideTimer);
  hideTimer = setTimeout(() => {
    controls.classList.remove("show");
  }, 3000);
}

/* Fullscreen */
document.getElementById("fullscreenBtn").onclick = () => {
  if (!document.fullscreenElement) {
    wrapper.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

/* Aspect fit/fill */
document.getElementById("aspectRatio").onchange = (e) => {
  const fit = e.target.value === "contain" ? "contain" : "cover";
  document.querySelectorAll("video").forEach(v => {
    v.style.objectFit = fit;
  });
};

window.addEventListener("DOMContentLoaded", () => {
  const { mpd, keyId, key } = getQueryParams();
  playStream(mpd, keyId, key);
});
</script>

</body>
</html>
