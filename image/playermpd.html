<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure HLS/DASH Player</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    #video-player, #clappr-player {
      width: 100%;
      height: 100vh;
      max-width: 100%;
      max-height: 100%;
      position: relative;
    }
    /* Control buttons */
    .view-controls {
      position: absolute;
      bottom: 15px;
      right: 15px;
      z-index: 9999;
      display: flex;
      gap: 8px;
    }
    .view-controls button {
      background: rgba(0,0,0,0.6);
      color: #fff;
      border: 1px solid #555;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    .view-controls button:hover {
      background: rgba(255,255,255,0.15);
    }
    video {
      width: 100% !important;
      height: 100% !important;
      object-fit: contain; /* default = FIT */
    }
  </style>
</head>
<body>
  <div id="video-player"></div>
  <div id="clappr-player" style="display:none;"></div>

  <!-- View Mode Controls -->
  <div class="view-controls">
    <button onclick="setView('fit')">Fit</button>
    <button onclick="setView('fill')">Fill</button>
    <button onclick="setView('zoom')">Zoom</button>
  </div>

  <!-- JW Player -->
  <script src="https://cdn.jwplayer.com/libraries/MAaRkUjT.js"></script>
  <!-- Clappr -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <!-- Clappr DRM -->
  <script src="https://cdn.jsdelivr.net/npm/clappr-drm@latest/dist/clappr-drm.min.js"></script>

  <script>
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        mpd: params.get("mpd"),
        keyId: params.get("keyId"),
        key: params.get("key")
      };
    }

    function isHLS(url) {
      return url.endsWith('.m3u8');
    }

    function isDASH(url) {
      return url.endsWith('.mpd');
    }

    function playStream(url, keyId, key) {
      if (!url) {
        document.body.innerHTML = "<p style='color:white;text-align:center;'>No stream URL provided.</p>";
        return;
      }

      // Try JWPlayer first
      if (typeof jwplayer !== 'undefined') {
        document.getElementById('video-player').style.display = 'block';
        const setupObj = {
          file: url,
          width: '100%',
          height: '100%',
          autostart: true
        };
        if (key && keyId) setupObj.drm = { clearkey: { keyId, key } };
        jwplayer('video-player').setup(setupObj);
        return;
      }

      // Fallback: Clappr
      document.getElementById('clappr-player').style.display = 'block';
      const config = {
        source: url,
        parentId: '#clappr-player',
        autoPlay: true,
        width: '100%',
        height: '100%'
      };
      if (key && keyId) {
        config.playback = {
          drm: {
            clearkey: {
              keys: [{ keyId, key }]
            }
          }
        };
        config.plugins = [ClapprDRM];
      }
      new Clappr.Player(config);
    }

    function setView(mode) {
      const video = document.querySelector('video');
      if (!video) return;

      if (mode === 'fit') {
        video.style.objectFit = 'contain';
        video.style.transform = 'scale(1)';
      }
      if (mode === 'fill') {
        video.style.objectFit = 'cover';
        video.style.transform = 'scale(1)';
      }
      if (mode === 'zoom') {
        video.style.objectFit = 'contain';
        video.style.transform = 'scale(1.3)';
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      const { mpd, keyId, key } = getQueryParams();
      playStream(mpd, keyId, key);
    });
  </script>
</body>
</html>
