
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure HLS/DASH Player</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    #video-player, #clappr-player {
      width: 100%;
      height: 100vh;
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <div id="video-player"></div>
  <div id="clappr-player" style="display:none;"></div>

  <!-- JW Player -->
  <script src="https://cdn.jwplayer.com/libraries/MAaRkUjT.js"></script>
  <!-- Clappr -->
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
  <!-- Clappr DRM -->
  <script src="https://cdn.jsdelivr.net/npm/clappr-drm@latest/dist/clappr-drm.min.js"></script>

  <script>
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        mpd: params.get("mpd"),
        keyId: params.get("keyId"),
        key: params.get("key")
      };
    }

    function isHLS(url) {
      return url.endsWith(".m3u8");
    }

    function isDASH(url) {
      return url.endsWith(".mpd");
    }

    function playStream(url, keyId, key) {
      if (!url) {
        document.body.innerHTML = "<p style='color:white;text-align:center;'>No stream URL provided.</p>";
        return;
      }

      const isDash = isDASH(url);
      const isHls = isHLS(url);

      // Try JWPlayer first
      if (typeof jwplayer !== "undefined") {
        document.getElementById("video-player").style.display = "block";
        const setupObj = {
          file: url,
          width: "100%",
          height: "100%",
          autostart: true
        };
        if (key && keyId) setupObj.drm = { clearkey: { keyId, key } };
        jwplayer("video-player").setup(setupObj);
        return;
      }

      // Fallback: Clappr
      document.getElementById("clappr-player").style.display = "block";
      const config = {
        source: url,
        parentId: "#clappr-player",
        autoPlay: true,
        width: "100%",
        height: "100%"
      };
      if (key && keyId) {
        config.playback = {
          drm: {
            clearkey: {
              keys: [{ keyId, key }]
            }
          }
        };
        config.plugins = [ClapprDRM];
      }
      new Clappr.Player(config);
    }

    window.addEventListener("DOMContentLoaded", () => {
      const { mpd, keyId, key } = getQueryParams();
      playStream(mpd, keyId, key);
    });
  </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"154a6d6f824a4b48bd21c665ca42757b","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
