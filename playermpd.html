<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Secure Fullscreen Player</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
}

/* Player container */
.player-wrapper {
  position: fixed;
  inset: 0;
  background: black;
}

/* JW / Clappr container */
#video-player, #clappr-player {
  width: 100vw;
  height: 100vh;
}

/* Force video full cover */
video {
  width: 100vw !important;
  height: 100vh !important;
  object-fit: cover !important;
  background: black;
}

/* Controls */
.controls {
  position: fixed;
  bottom: 15px;
  right: 15px;
  z-index: 9999;
  display: flex;
  gap: 10px;
  opacity: 1;
  transition: opacity 0.5s ease;
}

.controls.hide {
  opacity: 0;
  pointer-events: none;
}

.controls button {
  background: rgba(0,0,0,0.6);
  color: #fff;
  border: 1px solid #fff;
  padding: 8px 12px;
  font-size: 14px;
  border-radius: 4px;
}
</style>
</head>

<body>

<div class="player-wrapper">
  <div id="video-player"></div>
  <div id="clappr-player" style="display:none;"></div>
</div>

<div class="controls" id="controls">
  <button onclick="toggleFullscreen()">⛶</button>
  <button onclick="toggleFit()">↔</button>
</div>

<!-- JW Player -->
<script src="https://cdn.jwplayer.com/libraries/MAaRkUjT.js"></script>

<!-- Clappr -->
<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clappr-drm@latest/dist/clappr-drm.min.js"></script>

<script>
let fitMode = "cover";
let hideTimer;

function getQueryParams() {
  const p = new URLSearchParams(window.location.search);
  return {
    url: p.get("mpd"),
    keyId: p.get("keyId"),
    key: p.get("key")
  };
}

/* ===== FULLSCREEN ===== */
function toggleFullscreen() {
  const el = document.documentElement;
  if (!document.fullscreenElement) {
    el.requestFullscreen().catch(()=>{});
  } else {
    document.exitFullscreen();
  }
}

/* ===== FIT MODE ===== */
function toggleFit() {
  fitMode = fitMode === "cover" ? "contain" : "cover";
  document.querySelectorAll("video").forEach(v => {
    v.style.objectFit = fitMode;
  });
}

/* ===== AUTO HIDE CONTROLS ===== */
function showControls() {
  const c = document.getElementById("controls");
  c.classList.remove("hide");
  clearTimeout(hideTimer);
  hideTimer = setTimeout(() => {
    c.classList.add("hide");
  }, 3000);
}

document.addEventListener("mousemove", showControls);
document.addEventListener("touchstart", showControls);

/* ===== FORCE RESIZE (MOBILE FIX) ===== */
function forceResize() {
  document.querySelectorAll("video").forEach(v => {
    v.style.width = window.innerWidth + "px";
    v.style.height = window.innerHeight + "px";
  });
}
window.addEventListener("resize", forceResize);
window.addEventListener("orientationchange", () => {
  setTimeout(forceResize, 500);
});

/* ===== PLAYER ===== */
function playStream(url, keyId, key) {
  if (!url) {
    document.body.innerHTML =
      "<p style='color:white;text-align:center;'>No Stream URL</p>";
    return;
  }

  // JW Player
  if (typeof jwplayer !== "undefined") {
    jwplayer("video-player").setup({
      file: url,
      width: "100%",
      height: "100%",
      autostart: true,
      stretching: "fill"
    });

    jwplayer().on("ready", () => {
      forceResize();
      showControls();
    });
    return;
  }

  // Clappr fallback
  document.getElementById("clappr-player").style.display = "block";
  const config = {
    source: url,
    parentId: "#clappr-player",
    autoPlay: true,
    width: "100%",
    height: "100%"
  };

  if (key && keyId) {
    config.playback = {
      drm: { clearkey: { keys: [{ keyId, key }] } }
    };
    config.plugins = [ClapprDRM];
  }

  new Clappr.Player(config);
  setTimeout(() => {
    forceResize();
    showControls();
  }, 1000);
}

window.addEventListener("DOMContentLoaded", () => {
  const { url, keyId, key } = getQueryParams();
  playStream(url, keyId, key);
});
</script>

</body>
</html>
