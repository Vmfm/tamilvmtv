<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Secure HLS/DASH Player</title>

<style>
  body {
    margin: 0;
    background: #000;
    height: 100vh;
    overflow: hidden;
  }

  /* Player wrapper */
  #player-wrapper {
    position: relative;
    width: 100%;
    height: 100vh;
    background: black;
  }

  #video-player,
  #clappr-player {
    width: 100%;
    height: 100%;
  }

  /* Control bar */
  #controls {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 9999;
    display: flex;
    gap: 8px;
    background: rgba(0,0,0,0.6);
    padding: 6px 8px;
    border-radius: 6px;
  }

  #controls button,
  #controls select {
    background: #111;
    color: #fff;
    border: 1px solid #444;
    padding: 5px 8px;
    font-size: 13px;
    cursor: pointer;
    border-radius: 4px;
  }

  #controls button:hover,
  #controls select:hover {
    background: #222;
  }

  /* Aspect ratios */
  .ratio-auto video {
    object-fit: contain;
  }

  .ratio-16-9 {
    aspect-ratio: 16 / 9;
  }

  .ratio-4-3 {
    aspect-ratio: 4 / 3;
  }
</style>
</head>

<body>

<div id="player-wrapper" class="ratio-auto">
  <div id="controls">
    <select id="aspectRatio">
      <option value="auto">Auto</option>
      <option value="16-9">16:9</option>
      <option value="4-3">4:3</option>
    </select>
    <button id="fullscreenBtn">â›¶ Fullscreen</button>
  </div>

  <div id="video-player"></div>
  <div id="clappr-player" style="display:none;"></div>
</div>

<!-- JW Player -->
<script src="https://cdn.jwplayer.com/libraries/MAaRkUjT.js"></script>

<!-- Clappr -->
<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clappr-drm@latest/dist/clappr-drm.min.js"></script>

<script>
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  return {
    mpd: params.get("mpd"),
    keyId: params.get("keyId"),
    key: params.get("key")
  };
}

function playStream(url, keyId, key) {
  if (!url) {
    document.body.innerHTML =
      "<p style='color:white;text-align:center;'>No stream URL provided.</p>";
    return;
  }

  // JW Player
  if (typeof jwplayer !== "undefined") {
    document.getElementById("video-player").style.display = "block";
    jwplayer("video-player").setup({
      file: url,
      width: "100%",
      height: "100%",
      autostart: true,
      drm: key && keyId ? { clearkey: { keyId, key } } : undefined
    });
    return;
  }

  // Clappr fallback
  document.getElementById("clappr-player").style.display = "block";
  new Clappr.Player({
    source: url,
    parentId: "#clappr-player",
    autoPlay: true,
    width: "100%",
    height: "100%",
    plugins: key && keyId ? [ClapprDRM] : [],
    playback: key && keyId ? {
      drm: {
        clearkey: { keys: [{ keyId, key }] }
      }
    } : {}
  });
}

/* Fullscreen */
document.getElementById("fullscreenBtn").onclick = () => {
  const el = document.getElementById("player-wrapper");
  if (!document.fullscreenElement) {
    el.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

/* Aspect ratio switch */
document.getElementById("aspectRatio").onchange = (e) => {
  const wrapper = document.getElementById("player-wrapper");
  wrapper.classList.remove("ratio-auto", "ratio-16-9", "ratio-4-3");

  if (e.target.value === "16-9") wrapper.classList.add("ratio-16-9");
  else if (e.target.value === "4-3") wrapper.classList.add("ratio-4-3");
  else wrapper.classList.add("ratio-auto");
};

window.addEventListener("DOMContentLoaded", () => {
  const { mpd, keyId, key } = getQueryParams();
  playStream(mpd, keyId, key);
});
</script>

</body>
</html>
