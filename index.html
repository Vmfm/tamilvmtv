<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TAMIL VM LIVE TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link href="https://unpkg.com/video.js/dist/video-js.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<script src="https://unpkg.com/video.js/dist/video.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<style>
:root{
 --bg:#000;--card:#111;--text:#fff;--border:#333;
}
body.light{
 --bg:#f5f5f5;--card:#fff;--text:#000;--border:#ccc;
}
body{background:var(--bg);color:var(--text);font-family:sans-serif;margin:0;padding:0}

/* LOADER */
#loader{
 position:fixed;top:0;left:0;width:100%;height:100%;
 background:#000;display:flex;align-items:center;justify-content:center;z-index:100000;
}
#loader img{width:120px}

/* APK BUTTON */
.apk-btn{
 position:fixed;top:15px;left:15px;z-index:10001;
 background:#00c853;color:#000;padding:6px 12px;border-radius:20px;
 font-size:12px;font-weight:bold;text-decoration:none;
}

/* THEME TOGGLE */
.toggle-btn{
 position:fixed;top:15px;right:15px;z-index:10001;
 background:#ff9800;color:#000;border:none;padding:6px 12px;border-radius:20px;
}

/* HEADER + PLAYER */
.header{
 position:fixed;top:0;left:0;width:100%;
 background:var(--card);padding:10px;text-align:center;z-index:9999;
}
.video-js{width:100%;height:220px}

/* CONTROLS BELOW PLAYER */
.controls{
 position:fixed;top:240px;left:0;width:100%;padding:10px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;background:var(--card);z-index:9998;
}
.controls input, .controls select{
 flex:1;min-width:120px;padding:6px;border-radius:5px;border:1px solid var(--border);background:var(--card);color:var(--text);
}

/* SCROLLABLE CHANNEL LIST */
#channelContainer{
 position:fixed;top:300px;bottom:0;left:0;width:100%;
 overflow-y:auto;padding:10px;background:var(--bg);
}
.channel{
 border:1px solid var(--border);background:var(--card);margin-bottom:10px;text-align:center;cursor:pointer;padding:5px;
}
.channel img{width:100%;height:120px;object-fit:contain}
.channel p{font-size:12px;margin:3px 0}
.views{font-size:10px;color:#ff9800}

/* POP PLAYER */
#popPlayer{
 position:fixed;bottom:20px;right:20px;width:260px;background:#000;border-radius:10px;display:none;
 z-index:99999;box-shadow:0 0 15px #000;cursor:move;
}
#popPlayer video{width:100%;height:160px}
#closePop{
 position:absolute;top:5px;right:5px;background:red;color:#fff;border:none;border-radius:50%;width:22px;height:22px;
}

/* FULLSCREEN FILL */
.vjs-tech{object-fit:contain}
body.cover-mode .vjs-tech{object-fit:cover}
</style>
</head>
<body>

<!-- LOADER -->
<div id="loader">
 <img src="https://vmfm.github.io/tamilvmtv/image/loading-loader.gif" alt="Loading...">
</div>

<!-- APK DOWNLOAD -->
<a class="apk-btn" href="https://apk.e-droid.net/apk_t/app1386869_2829.apk?v=16" target="_blank">
‚¨á Android App
</a>

<!-- THEME TOGGLE -->
<button class="toggle-btn" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

<!-- HEADER + PLAYER -->
<div class="header">
 <h4 class="text-warning">TAMIL VM LIVE TV</h4>
 <video id="tvPlayer" class="video-js vjs-default-skin"
  controls autoplay playsinline webkit-playsinline></video>
</div>

<!-- POP PLAYER -->
<div id="popPlayer">
 <button id="closePop" onclick="closePop()">‚úñ</button>
 <video id="popVideo" class="video-js vjs-default-skin"
  controls playsinline webkit-playsinline></video>
</div>

<!-- SEARCH + CATEGORY CONTROLS -->
<div class="controls">
 <input type="text" id="search" placeholder="Search channel">
 <select id="category"><option value="all">All Categories</option></select>
</div>

<!-- SCROLLABLE CHANNEL LIST -->
<div id="channelContainer">
 <div class="row" id="channelList"></div>
</div>

<script>
const M3U_URL="https://vmfm.github.io/tamilvmtv/live/channels.m3u";
const player=videojs('tvPlayer');
const popPlayer=videojs('popVideo');
let allChannels=[],views=JSON.parse(localStorage.getItem('views')||'{}');
let currentSrc=null;

/* THEME */
if(localStorage.getItem('theme')==='light') document.body.classList.add('light');
function toggleTheme(){
 document.body.classList.toggle('light');
 localStorage.setItem('theme',
  document.body.classList.contains('light')?'light':'dark');
}

/* LOAD M3U */
fetch(M3U_URL).then(r=>r.text()).then(d=>{
 d.split('\n').forEach((l,i,a)=>{
  if(l.startsWith('#EXTINF')){
   allChannels.push({
    name:l.split(',').pop().trim(),
    logo:(l.match(/tvg-logo="(.*?)"/)||[])[1]||'https://via.placeholder.com/300x200?text=TV',
    group:(l.match(/group-title="(.*?)"/)||[])[1]||'Other',
    url:a[i+1]?.trim()
   });
  }
 });
 buildCategories();
 render();

 document.getElementById('loader').style.display='none';
});

/* CATEGORY */
function buildCategories(){
 [...new Set(allChannels.map(c=>c.group))]
 .forEach(g=>$('#category').append(`<option>${g}</option>`));
}

/* RENDER CHANNELS */
function render(){
 const s=$('#search').val().toLowerCase(),c=$('#category').val();
 $('#channelList').html('');
 allChannels.filter(x=>(c==='all'||x.group===c)
 && x.name.toLowerCase().includes(s))
 .forEach(x=>{
  $('#channelList').append(`
   <div class="col-4 col-md-2">
    <div class="channel" data-src="${x.url}" data-name="${x.name}">
     <img src="${x.logo}">
     <p>${x.name}</p>
     <div class="views">üëÅ ${(views[x.name]||0)} views</div>
    </div>
   </div>`);
 });
}
$('#search,#category').on('input change',render);

/* PLAY CHANNEL */
$(document).on('click','.channel',function(){
 const n=$(this).data('name');
 currentSrc=$(this).data('src');
 views[n]=(views[n]||0)+1;
 localStorage.setItem('views',JSON.stringify(views));
 render();
 player.src({src:currentSrc,type:'application/x-mpegURL'});
 player.play();
 window.scrollTo({top:0,behavior:'smooth'});
});

/* CLOSE POP PLAYER */
function closePop(){
 popPlayer.pause();
 $('#popPlayer').hide();
}

/* FULLSCREEN FILL BUTTON */
const zoomBtn=player.controlBar.addChild('button', {});
zoomBtn.addClass('vjs-control');
zoomBtn.el().innerHTML='‚õ∂';
zoomBtn.el().title='Fill Screen';
zoomBtn.onclick=()=>{
 document.body.classList.toggle('cover-mode');
};

/* AUTO ROTATE */
player.on('fullscreenchange',()=>{
 if(player.isFullscreen()){
  document.body.classList.add('cover-mode');
  screen.orientation?.lock('landscape').catch(()=>{});
 }else{
  document.body.classList.remove('cover-mode');
  screen.orientation?.unlock?.();
 }
});
</script>

</body>
</html>
