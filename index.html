<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TAMIL VM LIVE TV</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://unpkg.com/video.js/dist/video-js.css" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<script src="https://unpkg.com/video.js/dist/video.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<style>
:root{
 --bg:#000;
 --card:#111;
 --text:#fff;
 --border:#333;
}
body.light{
 --bg:#f5f5f5;
 --card:#fff;
 --text:#000;
 --border:#ccc;
}

body{
 background:var(--bg);
 color:var(--text);
 font-family:sans-serif;
}

/* HEADER */
.header{
 position:fixed;
 top:0;left:0;
 width:100%;
 background:var(--card);
 z-index:9999;
 padding:10px;
 text-align:center;
}

.video-js{width:100%;height:220px}
.main{margin-top:300px}

/* APK BUTTON */
.apk-btn{
 position:fixed;
 top:15px;
 left:15px;
 z-index:10001;
 background:#00c853;
 color:#000;
 padding:6px 12px;
 border-radius:20px;
 font-size:12px;
 font-weight:bold;
 text-decoration:none;
 box-shadow:0 0 8px #000;
}
.apk-btn:hover{background:#00e676;color:#000;text-decoration:none}

/* THEME TOGGLE */
.toggle-btn{
 position:fixed;
 top:15px;
 right:15px;
 z-index:10001;
 background:#ff9800;
 color:#000;
 border:none;
 padding:6px 12px;
 border-radius:20px;
 font-size:12px;
}

/* CHANNELS */
.channel{
 border:1px solid var(--border);
 background:var(--card);
 margin-bottom:10px;
 text-align:center;
 cursor:pointer;
 padding:5px;
}
.channel img{width:100%;height:120px;object-fit:contain}
.channel p{font-size:12px;margin:3px 0}
.views{font-size:10px;color:#ff9800}
</style>
</head>

<body>

<!-- APK DOWNLOAD BUTTON -->
<a class="apk-btn" href="https://apk.e-droid.net/apk_t/app1386869_2829.apk?v=16" target="_blank">
‚¨á Android App
</a>

<!-- THEME TOGGLE -->
<button class="toggle-btn" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

<!-- PLAYER -->
<div class="header">
 <h4 class="text-warning">TAMIL VM LIVE TV</h4>
 <video id="tvPlayer" class="video-js vjs-default-skin" controls autoplay playsinline></video>
</div>

<!-- CONTENT -->
<div class="container main">

 <div class="row mb-2">
  <div class="col-6">
   <input type="text" id="search" class="form-control" placeholder="Search channel">
  </div>
  <div class="col-6">
   <select id="category" class="form-control">
    <option value="all">All Categories</option>
   </select>
  </div>
 </div>

 <div class="row" id="channelList"></div>

</div>

<script>
const M3U_URL="https://vmfm.github.io/tamilvmtv/live/channels.m3u";
const player=videojs('tvPlayer');
let allChannels=[];
let views=JSON.parse(localStorage.getItem('views')||'{}');

/* THEME */
if(localStorage.getItem('theme')==='light'){
 document.body.classList.add('light');
}
function toggleTheme(){
 document.body.classList.toggle('light');
 localStorage.setItem('theme',
  document.body.classList.contains('light')?'light':'dark');
}

/* LOAD M3U */
fetch(M3U_URL).then(r=>r.text()).then(data=>{
 const lines=data.split('\n');
 for(let i=0;i<lines.length;i++){
  if(lines[i].startsWith('#EXTINF')){
   const name=lines[i].split(',').pop().trim();
   const logo=(lines[i].match(/tvg-logo="(.*?)"/)||[])[1]||'https://via.placeholder.com/300x200?text=TV';
   const group=(lines[i].match(/group-title="(.*?)"/)||[])[1]||'Other';
   const url=lines[i+1]?.trim();
   if(url) allChannels.push({name,logo,group,url});
  }
 }
 buildCategories();
 render();
});

/* CATEGORY */
function buildCategories(){
 [...new Set(allChannels.map(c=>c.group))]
 .forEach(g=>$('#category').append(`<option>${g}</option>`));
}

/* RENDER */
function render(){
 const s=$('#search').val().toLowerCase();
 const c=$('#category').val();
 $('#channelList').html('');
 allChannels.filter(x=>
  (c==='all'||x.group===c) &&
  x.name.toLowerCase().includes(s)
 ).forEach(x=>{
  const count=views[x.name]||0;
  $('#channelList').append(`
   <div class="col-4 col-md-2">
    <div class="channel" data-src="${x.url}" data-name="${x.name}">
     <img loading="lazy" src="${x.logo}">
     <p>${x.name}</p>
     <div class="views">üëÅ ${count} views</div>
    </div>
   </div>
  `);
 });
}

$('#search,#category').on('input change',render);

/* PLAY + COUNT */
$(document).on('click','.channel',function(){
 const name=$(this).data('name');
 views[name]=(views[name]||0)+1;
 localStorage.setItem('views',JSON.stringify(views));
 render();
 player.src({src:$(this).data('src'),type:'application/x-mpegURL'});
 player.play();
 player.requestFullscreen?.();
 window.scrollTo({top:0,behavior:'smooth'});
});
</script>

</body>
</html>
